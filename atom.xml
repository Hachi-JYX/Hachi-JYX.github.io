<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Python之道</title>
  <subtitle>天下事有难易乎？为之，则难者亦易矣；不为，则易者亦难矣。</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://yoursite.com/"/>
  <updated>2017-05-08T07:47:08.187Z</updated>
  <id>http://yoursite.com/</id>
  
  <author>
    <name>蒋逸欣</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Requests 库学习笔记</title>
    <link href="http://yoursite.com/2017/05/08/Requests-%E5%BA%93%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    <id>http://yoursite.com/2017/05/08/Requests-库学习笔记/</id>
    <published>2017-05-08T06:52:00.000Z</published>
    <updated>2017-05-08T07:47:08.187Z</updated>
    
    <content type="html"><![CDATA[<blockquote>
<p>爬虫学习路线第一站 - Requests库的使用</p>
</blockquote>
<a id="more"></a>
<h1 id="概览"><a href="#概览" class="headerlink" title="概览"></a>概览</h1><h2 id="实例引入"><a href="#实例引入" class="headerlink" title="实例引入"></a>实例引入</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 引入Requests库</span></div><div class="line"><span class="keyword">import</span> requests</div><div class="line"></div><div class="line"><span class="comment"># 发起GET请求</span></div><div class="line">response = requests.get(<span class="string">'https://www.baidu.com/'</span>)</div><div class="line"><span class="comment"># 查看响应类型  requests.models.Response</span></div><div class="line">print(type(response))</div><div class="line"><span class="comment"># 输出状态码</span></div><div class="line">print(response.status_code)</div><div class="line"><span class="comment"># 输出响应内容类型  text</span></div><div class="line">print(type(response.text))</div><div class="line"><span class="comment"># 输出响应内容</span></div><div class="line">print(response.text)</div><div class="line"><span class="comment"># 输出cookies</span></div><div class="line">print(response.cookies)</div></pre></td></tr></table></figure>
<h2 id="各种请求方式"><a href="#各种请求方式" class="headerlink" title="各种请求方式"></a>各种请求方式</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> requests</div><div class="line"></div><div class="line"><span class="comment"># 发起POST请求</span></div><div class="line">requests.post(<span class="string">'http://httpbin.org/post'</span>)</div><div class="line"><span class="comment"># 发起PUT请求</span></div><div class="line">requests.put(<span class="string">'http://httpbin.org/put'</span>)</div><div class="line"><span class="comment"># 发起DELETE请求</span></div><div class="line">requests.delete(<span class="string">'http://httpbin.org/delete'</span>)</div><div class="line"><span class="comment"># 发送HEAD请求</span></div><div class="line">requests.head(<span class="string">'http://httpbin.org/get'</span>)</div><div class="line"><span class="comment"># 发送OPTION请求</span></div><div class="line">requests.options(<span class="string">'http://httpbin.org/get'</span>)</div></pre></td></tr></table></figure>
<hr>
<h1 id="请求"><a href="#请求" class="headerlink" title="请求"></a>请求</h1><h2 id="基本GET请求"><a href="#基本GET请求" class="headerlink" title="基本GET请求"></a>基本GET请求</h2><h3 id="基本写法"><a href="#基本写法" class="headerlink" title="基本写法"></a>基本写法</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> requests</div><div class="line"></div><div class="line">response = requests.get(<span class="string">'http://httpbin.org/get'</span>)</div><div class="line">print(response.text)</div></pre></td></tr></table></figure>
<h3 id="带参数的GET请求"><a href="#带参数的GET请求" class="headerlink" title="带参数的GET请求"></a>带参数的GET请求</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> requests</div><div class="line"></div><div class="line">response = requests.get(<span class="string">'http://httpbin.org/get?name=jyx&amp;age=18'</span>)</div><div class="line">print(response.text)</div></pre></td></tr></table></figure>
<h3 id="带参数的GET请求-2"><a href="#带参数的GET请求-2" class="headerlink" title="带参数的GET请求(2)"></a>带参数的GET请求(2)</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> requests</div><div class="line"></div><div class="line"><span class="comment"># 分装GET请求参数</span></div><div class="line">param = &#123;<span class="string">'name'</span>:<span class="string">'jyx'</span>,<span class="string">'age'</span>:<span class="number">19</span>&#125;</div><div class="line"><span class="comment"># 设置GET请求参数(Params)</span></div><div class="line">response = requests.get(<span class="string">'http://httpbin.org/get'</span>,params=param)</div><div class="line">print(response.text)</div></pre></td></tr></table></figure>
<h3 id="解析json"><a href="#解析json" class="headerlink" title="解析json"></a>解析json</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> requests</div><div class="line"></div><div class="line">response = requests.get(<span class="string">'http://httpbin.org/get'</span>)</div><div class="line"><span class="comment"># 获取响应内容</span></div><div class="line">print(type(response.text))</div><div class="line"><span class="comment"># 如果响应内容是json,就将其转为json</span></div><div class="line">print(response.json())</div><div class="line"><span class="comment"># 输出的是字典类型</span></div><div class="line">print(type(response.json()))</div></pre></td></tr></table></figure>
<h3 id="获取二进制数据"><a href="#获取二进制数据" class="headerlink" title="获取二进制数据"></a>获取二进制数据</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> requests</div><div class="line"></div><div class="line">response = requests.get(<span class="string">'http://github.com/favicon.ico'</span>)</div><div class="line"></div><div class="line"><span class="comment"># str，bytes</span></div><div class="line">print(type(response.text),type(response.content))</div><div class="line"><span class="comment"># 输出响应的文本内容</span></div><div class="line">print(response.text)</div><div class="line"><span class="comment"># 输出响应的二进制内容</span></div><div class="line">print(response.content)</div><div class="line"><span class="comment"># 下载二进制数据到本地</span></div><div class="line"><span class="keyword">with</span> open(<span class="string">'favicon.ico'</span>,<span class="string">'wb'</span>) <span class="keyword">as</span> f:</div><div class="line">  f.write(response.content)</div><div class="line">  f.close()</div></pre></td></tr></table></figure>
<h3 id="添加headers"><a href="#添加headers" class="headerlink" title="添加headers"></a>添加headers</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> requests</div><div class="line"></div><div class="line"><span class="comment"># 设置User-Agent浏览器信息</span></div><div class="line">headers = &#123;</div><div class="line">      <span class="string">"User-Agent"</span>: <span class="string">"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/57.0.2987.133 Safari/537.36"</span></div><div class="line">&#125;</div><div class="line"><span class="comment"># 设置请求头信息</span></div><div class="line">response = requests.get(<span class="string">'https://www.zhihu.com/explore'</span>,headers=headers)</div><div class="line">print(response.text)</div></pre></td></tr></table></figure>
<h2 id="基本POST请求"><a href="#基本POST请求" class="headerlink" title="基本POST请求"></a>基本POST请求</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> requests</div><div class="line"></div><div class="line"><span class="comment"># 设置传入post表单信息</span></div><div class="line">data= &#123; <span class="string">'name'</span>:<span class="string">'jyx'</span>, <span class="string">'age'</span>:<span class="number">18</span>&#125;</div><div class="line"><span class="comment"># 设置请求头信息</span></div><div class="line">headers = &#123;</div><div class="line">      <span class="string">"User-Agent"</span>: <span class="string">"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/57.0.2987.133 Safari/537.36"</span></div><div class="line">&#125;</div><div class="line"><span class="comment"># 设置请求头信息和POST请求参数(data)</span></div><div class="line">response = requests.post(<span class="string">'http://httpbin.org/post'</span>, data=data, headers=headers)</div><div class="line">print(response.text)</div></pre></td></tr></table></figure>
<hr>
<h1 id="响应"><a href="#响应" class="headerlink" title="响应"></a>响应</h1><h2 id="response属性"><a href="#response属性" class="headerlink" title="response属性"></a>response属性</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> requests</div><div class="line"></div><div class="line">response = requests.get(<span class="string">'http://www.jianshu.com/'</span>)</div><div class="line"><span class="comment"># 获取响应状态码</span></div><div class="line">print(type(response.status_code),response.status_code)</div><div class="line"><span class="comment"># 获取响应头信息</span></div><div class="line"> print(type(response.headers),response.headers)</div><div class="line"><span class="comment"># 获取响应头中的cookies</span></div><div class="line">print(type(response.cookies),response.cookies)</div><div class="line"><span class="comment"># 获取访问的url</span></div><div class="line"> print(type(response.url),response.url)</div><div class="line"><span class="comment"># 获取访问的历史记录</span></div><div class="line"> print(type(response.history),response.history)</div></pre></td></tr></table></figure>
<h2 id="状态码判断"><a href="#状态码判断" class="headerlink" title="状态码判断"></a>状态码判断</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> requests</div><div class="line"></div><div class="line">response = requests.get(<span class="string">'http://www.jianshu.com/404.html'</span>)</div><div class="line"><span class="comment"># 使用request内置的字母判断状态码</span></div><div class="line"><span class="keyword">if</span> <span class="keyword">not</span> response.status_code == requests.codes.ok:</div><div class="line">    print(<span class="string">'404-1'</span>)</div><div class="line">response = requests.get(<span class="string">'http://www.jianshu.com'</span>)</div><div class="line"><span class="comment"># 使用状态码数字判断</span></div><div class="line"><span class="keyword">if</span> <span class="keyword">not</span> response.status_code == <span class="number">200</span>:</div><div class="line">    print(<span class="string">'404-2'</span>)</div></pre></td></tr></table></figure>
<h2 id="requests内置的状态字符"><a href="#requests内置的状态字符" class="headerlink" title="requests内置的状态字符"></a>requests内置的状态字符</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div></pre></td><td class="code"><pre><div class="line">100: (&apos;continue&apos;,),</div><div class="line">101: (&apos;switching_protocols&apos;,),</div><div class="line">102: (&apos;processing&apos;,),</div><div class="line">103: (&apos;checkpoint&apos;,),</div><div class="line">122: (&apos;uri_too_long&apos;, &apos;request_uri_too_long&apos;),</div><div class="line">200: (&apos;ok&apos;, &apos;okay&apos;, &apos;all_ok&apos;, &apos;all_okay&apos;, &apos;all_good&apos;, &apos;\\o/&apos;, &apos;✓&apos;),</div><div class="line">201: (&apos;created&apos;,),</div><div class="line">202: (&apos;accepted&apos;,),</div><div class="line">203: (&apos;non_authoritative_info&apos;, &apos;non_authoritative_information&apos;),</div><div class="line">204: (&apos;no_content&apos;,),</div><div class="line">205: (&apos;reset_content&apos;, &apos;reset&apos;),</div><div class="line">206: (&apos;partial_content&apos;, &apos;partial&apos;),</div><div class="line">207: (&apos;multi_status&apos;, &apos;multiple_status&apos;, &apos;multi_stati&apos;, &apos;multiple_stati&apos;),</div><div class="line">208: (&apos;already_reported&apos;,),</div><div class="line">226: (&apos;im_used&apos;,),</div><div class="line"># Redirection.</div><div class="line">300: (&apos;multiple_choices&apos;,),</div><div class="line">301: (&apos;moved_permanently&apos;, &apos;moved&apos;, &apos;\\&apos;),</div><div class="line">302: (&apos;found&apos;,),</div><div class="line">303: (&apos;see_other&apos;, &apos;other&apos;),</div><div class="line">304: (&apos;not_modified&apos;,),</div><div class="line">305: (&apos;use_proxy&apos;,),</div><div class="line">306: (&apos;switch_proxy&apos;,),</div><div class="line">307: (&apos;temporary_redirect&apos;, &apos;temporary_moved&apos;, &apos;temporary&apos;),</div><div class="line">308: (&apos;permanent_redirect&apos;, &apos;resume_incomplete&apos;, &apos;resume&apos;,), # These 2 to be removed in 3.0</div><div class="line"># Client Error.</div><div class="line">400: (&apos;bad_request&apos;, &apos;bad&apos;),</div><div class="line">401: (&apos;unauthorized&apos;,),</div><div class="line">402: (&apos;payment_required&apos;, &apos;payment&apos;),</div><div class="line">403: (&apos;forbidden&apos;,),</div><div class="line">404: (&apos;not_found&apos;, &apos;-&apos;),</div><div class="line">405: (&apos;method_not_allowed&apos;, &apos;not_allowed&apos;),</div><div class="line">406: (&apos;not_acceptable&apos;,),</div><div class="line">407: (&apos;proxy_authentication_required&apos;, &apos;proxy_auth&apos;, &apos;proxy_authentication&apos;),</div><div class="line">408: (&apos;request_timeout&apos;, &apos;timeout&apos;),</div><div class="line">409: (&apos;conflict&apos;,),</div><div class="line">410: (&apos;gone&apos;,),</div><div class="line">411: (&apos;length_required&apos;,),</div><div class="line">412: (&apos;precondition_failed&apos;, &apos;precondition&apos;),</div><div class="line">413: (&apos;request_entity_too_large&apos;,),</div><div class="line">414: (&apos;request_uri_too_large&apos;,),</div><div class="line">415: (&apos;unsupported_media_type&apos;, &apos;unsupported_media&apos;, &apos;media_type&apos;),</div><div class="line">416: (&apos;requested_range_not_satisfiable&apos;, &apos;requested_range&apos;, &apos;range_not_satisfiable&apos;),</div><div class="line">417: (&apos;expectation_failed&apos;,),</div><div class="line">418: (&apos;im_a_teapot&apos;, &apos;teapot&apos;, &apos;i_am_a_teapot&apos;),</div><div class="line">421: (&apos;misdirected_request&apos;,),</div><div class="line">422: (&apos;unprocessable_entity&apos;, &apos;unprocessable&apos;),</div><div class="line">423: (&apos;locked&apos;,),</div><div class="line">424: (&apos;failed_dependency&apos;, &apos;dependency&apos;),</div><div class="line">425: (&apos;unordered_collection&apos;, &apos;unordered&apos;),</div><div class="line">426: (&apos;upgrade_required&apos;, &apos;upgrade&apos;),</div><div class="line">428: (&apos;precondition_required&apos;, &apos;precondition&apos;),</div><div class="line">429: (&apos;too_many_requests&apos;, &apos;too_many&apos;),</div><div class="line">431: (&apos;header_fields_too_large&apos;, &apos;fields_too_large&apos;),</div><div class="line">444: (&apos;no_response&apos;, &apos;none&apos;),</div><div class="line">449: (&apos;retry_with&apos;, &apos;retry&apos;),</div><div class="line">450: (&apos;blocked_by_windows_parental_controls&apos;, &apos;parental_controls&apos;),</div><div class="line">451: (&apos;unavailable_for_legal_reasons&apos;, &apos;legal_reasons&apos;),</div><div class="line">499: (&apos;client_closed_request&apos;,),</div><div class="line"># Server Error.</div><div class="line">500: (&apos;internal_server_error&apos;, &apos;server_error&apos;, &apos;/o\\&apos;, &apos;✗&apos;),</div><div class="line">501: (&apos;not_implemented&apos;,),</div><div class="line">502: (&apos;bad_gateway&apos;,),</div><div class="line">503: (&apos;service_unavailable&apos;, &apos;unavailable&apos;),</div><div class="line">504: (&apos;gateway_timeout&apos;,),</div><div class="line">505: (&apos;http_version_not_supported&apos;, &apos;http_version&apos;),</div><div class="line">506: (&apos;variant_also_negotiates&apos;,),</div><div class="line">507: (&apos;insufficient_storage&apos;,),</div><div class="line">509: (&apos;bandwidth_limit_exceeded&apos;, &apos;bandwidth&apos;),</div><div class="line">510: (&apos;not_extended&apos;,),</div><div class="line">511: (&apos;network_authentication_required&apos;, &apos;network_auth&apos;, &apos;network_authentication&apos;),</div></pre></td></tr></table></figure>
<hr>
<h1 id="高级操作"><a href="#高级操作" class="headerlink" title="高级操作"></a>高级操作</h1><h2 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> requests</div><div class="line"></div><div class="line">files = &#123;<span class="string">'file'</span>:open(<span class="string">'favicon.ico'</span>,<span class="string">'rb'</span>)&#125;</div><div class="line"><span class="comment"># 往POST请求头中设置文件(files)</span></div><div class="line">response = requests.post(<span class="string">'http://httpbin.org/post'</span>,files=files)</div><div class="line">print(response.text)</div></pre></td></tr></table></figure>
<h2 id="获取cookies"><a href="#获取cookies" class="headerlink" title="获取cookies"></a>获取cookies</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> requests</div><div class="line"></div><div class="line">response = requests.get(<span class="string">'https://www.baidu.com'</span>)</div><div class="line">print(response.cookies)</div><div class="line"><span class="keyword">for</span> key,value <span class="keyword">in</span> response.cookies.items():</div><div class="line">    print(key,<span class="string">'====='</span>,value)</div></pre></td></tr></table></figure>
<h2 id="会话维持"><a href="#会话维持" class="headerlink" title="会话维持"></a>会话维持</h2><h3 id="普通请求"><a href="#普通请求" class="headerlink" title="普通请求"></a>普通请求</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> requests</div><div class="line"></div><div class="line">requests.get(<span class="string">'http://httpbin.org/cookies/set/number/12456'</span>)</div><div class="line">response = requests.get(<span class="string">'http://httpbin.org/cookies'</span>)</div><div class="line"><span class="comment"># 本质上是两次不同的请求，session不一致</span></div><div class="line">print(response.text)</div></pre></td></tr></table></figure>
<h3 id="会话维持请求"><a href="#会话维持请求" class="headerlink" title="会话维持请求"></a>会话维持请求</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> requests</div><div class="line"></div><div class="line"><span class="comment"># 从Requests中获取session</span></div><div class="line">session = requests.session()</div><div class="line"><span class="comment"># 使用seesion去请求保证了请求是同一个session</span></div><div class="line">session.get(<span class="string">'http://httpbin.org/cookies/set/number/12456'</span>)</div><div class="line">response = session.get(<span class="string">'http://httpbin.org/cookies'</span>)</div><div class="line">print(response.text)</div></pre></td></tr></table></figure>
<h2 id="证书验证"><a href="#证书验证" class="headerlink" title="证书验证"></a>证书验证</h2><h3 id="无证书访问"><a href="#无证书访问" class="headerlink" title="无证书访问"></a>无证书访问</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> requests</div><div class="line"></div><div class="line">response = requests.get(<span class="string">'https://www.12306.cn'</span>)</div><div class="line"><span class="comment"># 在请求https时，request会进行证书的验证，如果验证失败则会抛出异常</span></div><div class="line">print(response.status_code)</div></pre></td></tr></table></figure>
<h3 id="关闭证书验证"><a href="#关闭证书验证" class="headerlink" title="关闭证书验证"></a>关闭证书验证</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> requests</div><div class="line"></div><div class="line"><span class="comment"># 关闭验证，但是仍然会报出证书警告</span></div><div class="line">response = requests.get(<span class="string">'https://www.12306.cn'</span>,verify=<span class="keyword">False</span>)</div><div class="line">print(response.status_code)</div></pre></td></tr></table></figure>
<h3 id="消除关闭证书验证的警告"><a href="#消除关闭证书验证的警告" class="headerlink" title="消除关闭证书验证的警告"></a>消除关闭证书验证的警告</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> requests.packages <span class="keyword">import</span> urllib3</div><div class="line"><span class="keyword">import</span> requests</div><div class="line"></div><div class="line"><span class="comment"># 关闭警告</span></div><div class="line">urllib3.disable_warnings()</div><div class="line">response = requests.get(<span class="string">'https://www.12306.cn'</span>,verify=<span class="keyword">False</span>)</div><div class="line">print(response.status_code)</div></pre></td></tr></table></figure>
<h3 id="手动设置证书"><a href="#手动设置证书" class="headerlink" title="手动设置证书"></a>手动设置证书</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> requests</div><div class="line"></div><div class="line"><span class="comment"># 设置本地证书</span></div><div class="line">response = requests.get(<span class="string">'https://www.12306.cn'</span>, cert=(<span class="string">'/path/server.crt'</span>, <span class="string">'/path/key'</span>))</div><div class="line">print(response.status_code)</div></pre></td></tr></table></figure>
<h2 id="代理设置"><a href="#代理设置" class="headerlink" title="代理设置"></a>代理设置</h2><h3 id="设置普通代理"><a href="#设置普通代理" class="headerlink" title="设置普通代理"></a>设置普通代理</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> requests</div><div class="line"></div><div class="line">proxies = &#123;</div><div class="line">    <span class="string">"http"</span>: <span class="string">"http://127.0.0.1:9743"</span>,</div><div class="line">    <span class="string">"https"</span>: <span class="string">"https://127.0.0.1:9743"</span>,</div><div class="line">&#125;</div><div class="line"><span class="comment"># 往请求中设置代理(proxies</span></div><div class="line">)</div><div class="line">response = requests.get(<span class="string">"https://www.taobao.com"</span>, proxies=proxies)</div><div class="line">print(response.status_code)</div></pre></td></tr></table></figure>
<h3 id="设置带有用户名和密码的代理"><a href="#设置带有用户名和密码的代理" class="headerlink" title="设置带有用户名和密码的代理"></a>设置带有用户名和密码的代理</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">mport requests</div><div class="line"></div><div class="line">proxies = &#123;</div><div class="line">    <span class="string">"http"</span>: <span class="string">"http://user:password@127.0.0.1:9743/"</span>,</div><div class="line">&#125;</div><div class="line">response = requests.get(<span class="string">"https://www.taobao.com"</span>, proxies=proxies)</div><div class="line">print(response.status_code)</div></pre></td></tr></table></figure>
<h3 id="设置socks代理"><a href="#设置socks代理" class="headerlink" title="设置socks代理"></a>设置socks代理</h3><blockquote>
<p>pip3 install ‘requests[socks]</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> requests</div><div class="line"></div><div class="line">proxies = &#123;</div><div class="line">    <span class="string">'http'</span>: <span class="string">'socks5://127.0.0.1:9742'</span>,</div><div class="line">    <span class="string">'https'</span>: <span class="string">'socks5://127.0.0.1:9742'</span></div><div class="line">&#125;</div><div class="line">response = requests.get(<span class="string">"https://www.taobao.com"</span>, proxies=proxies)</div><div class="line">print(response.status_code)</div></pre></td></tr></table></figure>
<h2 id="超时设置"><a href="#超时设置" class="headerlink" title="超时设置"></a>超时设置</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> requests</div><div class="line"><span class="keyword">from</span> requests.exceptions <span class="keyword">import</span> ReadTimeout   </div><div class="line"></div><div class="line"><span class="keyword">try</span>:</div><div class="line">   <span class="comment"># 设置必须在500ms内收到响应，不然或抛出ReadTimeout异常</span></div><div class="line">   response = requests.get(<span class="string">"http://httpbin.org/get"</span>, timeout=<span class="number">0.5</span>)</div><div class="line">            print(response.status_code)</div><div class="line"><span class="keyword">except</span> ReadTimeout:</div><div class="line">   print(<span class="string">'Timeout'</span>)</div></pre></td></tr></table></figure>
<h2 id="认证设置"><a href="#认证设置" class="headerlink" title="认证设置"></a>认证设置</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> requests</div><div class="line"><span class="keyword">from</span> requests.auth <span class="keyword">import</span> HTTPBasicAuth</div><div class="line"></div><div class="line">r = requests.get(<span class="string">'http://120.27.34.24:9001'</span>, auth=HTTPBasicAuth(<span class="string">'user'</span>, <span class="string">'123'</span>))</div><div class="line"><span class="comment"># r = requests.get('http://120.27.34.24:9001', auth=('user', '123'))</span></div><div class="line">print(r.status_code)</div></pre></td></tr></table></figure>
<h2 id="异常处理"><a href="#异常处理" class="headerlink" title="异常处理"></a>异常处理</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> requests</div><div class="line"><span class="keyword">from</span> requests.exceptions <span class="keyword">import</span> ReadTimeout, ConnectionError, RequestException</div><div class="line"></div><div class="line"><span class="keyword">try</span>:</div><div class="line">   response = requests.get(<span class="string">"http://httpbin.org/get"</span>, timeout = <span class="number">0.5</span>)</div><div class="line">           print(response.status_code)</div><div class="line"><span class="keyword">except</span> ReadTimeout:</div><div class="line">   <span class="comment"># 超时异常</span></div><div class="line">   print(<span class="string">'Timeout'</span>)</div><div class="line"><span class="keyword">except</span> ConnectionError:</div><div class="line">   <span class="comment"># 连接异常</span></div><div class="line">   print(<span class="string">'Connection error'</span>)</div><div class="line"><span class="keyword">except</span> RequestException:</div><div class="line">   <span class="comment"># 请求异常</span></div><div class="line">   print(<span class="string">'Error'</span>)</div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;爬虫学习路线第一站 - Requests库的使用&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="爬虫" scheme="http://yoursite.com/categories/%E7%88%AC%E8%99%AB/"/>
    
    
      <category term="爬虫库" scheme="http://yoursite.com/tags/%E7%88%AC%E8%99%AB%E5%BA%93/"/>
    
  </entry>
  
</feed>
